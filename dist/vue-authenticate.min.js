/*!
 * vue-authenticate v1.2.1
 * https://github.com/dgrubelic/vue-authenticate
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueAuthenticate=e()}(this,function(){"use strict";function t(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,o,n){return n?o.toUpperCase():o})}function e(t){return null!==t&&"object"==typeof t}function o(t){return"string"==typeof t}function n(t){return"function"==typeof t}function r(t,e){return null==t||null==e?t:(Object.keys(e).forEach(function(o){"[object Object]"==Object.prototype.toString.call(e[o])?"[object Object]"!=Object.prototype.toString.call(t[o])?t[o]=e[o]:t[o]=r(t[o],e[o]):t[o]=e[o]}),t)}function i(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;var o=[t,e].join("/");return function(t){return t.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}(o)}function s(t){var e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function a(t){var e,o,n={};return(t||"").split("&").forEach(function(t){t&&(o=t.split("="),e=decodeURIComponent(o[0]),n[e]=!o[1]||decodeURIComponent(o[1]))}),n}function p(t){var e;if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(t){}var o=String.fromCharCode,n=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),r=function(t){switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return o(55296+(n>>>10))+o(56320+(1023&n));case 3:return o((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return o((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},i=function(t){return t.replace(n,r)};return(e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return i(atob(t))})(String(t).replace(/[-_]/g,function(t){return"-"===t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function u(){}function c(t,e){return function(){t.apply(e,arguments)}}function h(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],v(t,this)}function l(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,h._immediateFn(function(){var o=1===t._state?e.onFulfilled:e.onRejected;if(null===o)return void(1===t._state?f:d)(e.promise,t._value);var n;try{n=o(t._value)}catch(t){return void d(e.promise,t)}f(e.promise,n)})}function f(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var o=e.then;if(e instanceof h)return t._state=3,t._value=e,void g(t);if("function"==typeof o)return void v(c(o,e),t)}t._state=1,t._value=e,g(t)}catch(e){d(t,e)}}function d(t,e){t._state=2,t._value=e,g(t)}function g(t){2===t._state&&0===t._deferreds.length&&h._immediateFn(function(){t._handled||h._unhandledRejectionFn(t._value)});for(var e=0,o=t._deferreds.length;e<o;e++)l(t,t._deferreds[e]);t._deferreds=null}function m(t,e,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=o}function v(t,e){var o=!1;try{t(function(t){o||(o=!0,f(e,t))},function(t){o||(o=!0,d(e,t))})}catch(t){if(o)return;o=!0,d(e,t)}}function y(t){switch(t.storageType){case"localStorage":try{return window.localStorage.setItem("testKey","test"),window.localStorage.removeItem("testKey"),new _(t.storageNamespace)}catch(t){}case"sessionStorage":try{return window.sessionStorage.setItem("testKey","test"),window.sessionStorage.removeItem("testKey"),new k(t.storageNamespace)}catch(t){}case"memoryStorage":default:return new I(t.storageNamespace)}}function w(t,e){if(!w.installed){w.installed=!0,w.factory=function(t,e){return new O(t,e)};var o=null;Object.defineProperties(t.prototype,{$auth:{get:function(){if(!o){if(!this.$http)throw new Error("Request handler instance not found");o=new O(this.$http,e)}return o}}})}}"function"!=typeof Object.assign&&(Object.assign=function(t,e){var o=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var i=o[r];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n});var b=setTimeout;h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){var o=new this.constructor(u);return l(this,new m(t,e,o)),o},h.all=function(t){var e=Array.prototype.slice.call(t);return new h(function(t,o){function n(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(t){n(i,t)},o)}e[i]=s,0==--r&&t(e)}catch(t){o(t)}}if(0===e.length)return t([]);for(var r=e.length,i=0;i<e.length;i++)n(i,e[i])})},h.resolve=function(t){return t&&"object"==typeof t&&t.constructor===h?t:new h(function(e){e(t)})},h.reject=function(t){return new h(function(e,o){o(t)})},h.race=function(t){return new h(function(e,o){for(var n=0,r=t.length;n<r;n++)t[n].then(e,o)})},h._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){b(t,0)},h._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},h._setImmediateFn=function(t){h._immediateFn=t},h._setUnhandledRejectionFn=function(t){h._unhandledRejectionFn=t};var C={baseUrl:null,tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-authenticate",requestDataKey:"body",responseDataKey:"body",bindRequestInterceptor:null,bindResponseInterceptor:null,providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.5/dialog/oauth",redirectUri:null,requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:null,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:null,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:null,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0"},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:null,oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:null,optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}}}},_=function(t){this.namespace=t||null};_.prototype.setItem=function(t,e){window.localStorage.setItem(this._getStorageKey(t),e)},_.prototype.getItem=function(t){return window.localStorage.getItem(this._getStorageKey(t))},_.prototype.removeItem=function(t){window.localStorage.removeItem(this._getStorageKey(t))},_.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};var I=function(t){this.namespace=t||null,this._storage={}};I.prototype.setItem=function(t,e){this._storage[this._getStorageKey(t)]=e},I.prototype.getItem=function(t){return this._storage[this._getStorageKey(t)]},I.prototype.removeItem=function(t){delete this._storage[this._getStorageKey(t)]},I.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};var k=function(t){this.namespace=t||null};k.prototype.setItem=function(t,e){window.sessionStorage.setItem(this._getStorageKey(t),e)},k.prototype.getItem=function(t){return window.sessionStorage.getItem(this._getStorageKey(t))},k.prototype.removeItem=function(t){window.sessionStorage.removeItem(this._getStorageKey(t))},k.prototype._getStorageKey=function(t){return this.namespace?[this.namespace,t].join("."):t};var U=function(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o};U.prototype.open=function(t,e){try{return this.popup=window.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),e?h.resolve():this.pooling(t)}catch(t){return h.reject(new Error("OAuth popup error occurred"))}},U.prototype.pooling=function(t){var e=this;return new h(function(o,n){var i=document.createElement("a");i.href=t;var p=s(i),u=setInterval(function(){e.popup&&!e.popup.closed&&void 0!==e.popup.closed||(clearInterval(u),u=null,n(new Error("Auth popup window closed")));try{if(s(e.popup.location)===p){if(e.popup.location.search||e.popup.location.hash){var t=a(e.popup.location.search.substring(1).replace(/\/$/,"")),i=a(e.popup.location.hash.substring(1).replace(/[\/$]/,"")),c=r({},t);c=r(c,i),c.error?n(new Error(c.error)):o(c)}else n(new Error("OAuth redirect has occurred but no query or hash parameters were found."));clearInterval(u),u=null,e.popup.close()}}catch(t){}},250)})},U.prototype._stringifyOptions=function(){var t=this,e=[];for(var o in t.popupOptions)e.push(o+"="+t.popupOptions[o]);return e.join(",")};var P={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{width:null,height:null}},j=function(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=r({},P),this.providerConfig=r(this.providerConfig,o),this.options=n};j.prototype.init=function(t){var e=this;return this.oauthPopup=new U("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),window&&!window.cordova&&this.oauthPopup.open(this.providerConfig.redirectUri,!0),this.getRequestToken().then(function(o){return e.openPopup(o).then(function(o){return e.exchangeForToken(o,t)})})},j.prototype.getRequestToken=function(){var t={};return t.method="POST",t[this.options.requestDataKey]=r({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=i(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)},j.prototype.openPopup=function(t){var e=[this.providerConfig.authorizationEndpoint,this.buildQueryString(t[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=e,window&&window.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)},j.prototype.exchangeForToken=function(t,e){var o=r({},e);o=r(o,t);var n={};return n.method="POST",n[this.options.requestDataKey]=o,n.withCredentials=this.options.withCredentials,this.options.baseUrl?n.url=i(this.options.baseUrl,this.providerConfig.url):n.url=this.providerConfig.url,this.$http(n)},j.prototype.buildQueryString=function(t){var e=[];for(var o in t){var n=t[o];e.push(encodeURIComponent(o)+"="+encodeURIComponent(n))}return e.join("&")};var S={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{width:null,height:null}},T=function(t,e,o,n){this.$http=t,this.storage=e,this.providerConfig=r({},S),this.providerConfig=r(this.providerConfig,o),this.options=n};T.prototype.init=function(t){var e=this,r=this.providerConfig.name;n(this.providerConfig.state)?this.storage.setItem(r,this.providerConfig.state()):o(this.providerConfig.state)&&this.storage.setItem(r,this.providerConfig.state);var i=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");return this.oauthPopup=new U(i,this.providerConfig.name,this.providerConfig.popupOptions),new Promise(function(o,n){e.oauthPopup.open(e.providerConfig.redirectUri).then(function(i){return"token"!==e.providerConfig.responseType&&e.providerConfig.url?i.state&&i.state!==e.storage.getItem(r)?n(new Error("State parameter value does not match original OAuth request state value")):void o(e.exchangeForToken(i,t)):o(i)}).catch(function(t){n(t)})})},T.prototype.exchangeForToken=function(t,e){var o=this,n=r({},e);for(var s in S.responseParams){switch(s){case"code":n[s]=t.code;break;case"clientId":n[s]=o.providerConfig.clientId;break;case"redirectUri":n[s]=o.providerConfig.redirectUri;break;default:n[s]=t[s]}}t.state&&(n.state=t.state);var a;return a=this.options.baseUrl?i(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(a,n,{withCredentials:this.options.withCredentials})},T.prototype._stringifyRequestParams=function(){var e=this,o=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(function(r){e.providerConfig[r]&&Array.isArray(e.providerConfig[r])&&e.providerConfig[r].forEach(function(r){var i=t(r),s=n(e.providerConfig[r])?e.providerConfig[r]():e.providerConfig[i];if("redirect_uri"!==r||s){if("state"===r){var a=e.defaults.name+"_state";s=encodeURIComponent(e.storage.getItem(a))}"scope"===r&&Array.isArray(s)&&(s=s.join(e.providerConfig.scopeDelimiter),e.providerConfig.scopePrefix&&(s=[e.providerConfig.scopePrefix,s].join(e.providerConfig.scopeDelimiter))),o.push([r,s])}})}),o.map(function(t){return t.join("=")}).join("&")};var O=function(t,e){var o=this,i=r({},C);i=r(i,e);var s=y(i);Object.defineProperties(this,{$http:{get:function(){return t}},options:{get:function(){return i}},storage:{get:function(){return s}},tokenName:{get:function(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),this.options.bindRequestInterceptor&&n(this.options.bindRequestInterceptor)?(this.options.bindRequestInterceptor.call(this),this.options.bindResponseInterceptor&&n(this.options.bindResponseInterceptor)&&this.options.bindResponseInterceptor.call(this)):this.$http.interceptors.push(function(t,e){o.isAuthenticated()?t.headers.set("Authorization",[o.options.tokenType,o.getToken()].join(" ")):t.headers.delete("Authorization"),o.options.bindResponseInterceptor&&n(o.options.bindResponseInterceptor)?o.options.bindResponseInterceptor.call(o):e(function(t){try{var e=JSON.parse(t[o.options.responseDataKey]);if(e[o.options.tokenName])return o.setToken(e),delete e[o.options.tokenName],e}catch(t){}return t})})};return O.prototype.isAuthenticated=function(){var t=this.storage.getItem(this.tokenName);if(t){if(3===t.split(".").length)try{var e=t.split(".")[1],o=e.replace("-","+").replace("_","/"),n=JSON.parse(window.atob(o)).exp;if("number"==typeof n)return Math.round((new Date).getTime()/1e3)<n}catch(t){return!0}return!0}return!1},O.prototype.getToken=function(){return this.storage.getItem(this.tokenName)},O.prototype.setToken=function(t){t[this.options.requestDataKey]&&(t=t[this.options.requestDataKey]);var n;t.access_token&&(e(t.access_token)&&e(t.access_token[this.options.requestDataKey])?t=t.access_token:o(t.access_token)&&(n=t.access_token)),!n&&t&&(n=t[this.options.tokenName]),n&&this.storage.setItem(this.tokenName,n)},O.prototype.getPayload=function(){var t=this.storage.getItem(this.tokenName);if(t&&3===t.split(".").length)try{var e=t.split(".")[1],o=e.replace("-","+").replace("_","/");return JSON.parse(p(o))}catch(t){console.log(t)}},O.prototype.login=function(t,e){var o=this;return e=e||{},e.url=e.url?e.url:i(this.options.baseUrl,this.options.loginUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials,this.$http(e).then(function(t){return o.setToken(t),t})},O.prototype.register=function(t,e){var o=this;return e=e||{},e.url=e.url?e.url:i(this.options.baseUrl,this.options.registerUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials,this.$http(e).then(function(t){return o.setToken(t),t})},O.prototype.logout=function(t){var e=this;return this.isAuthenticated()?(t=t||{},t.url=t.logoutUrl||this.options.logoutUrl,t.url?(t.method=t.method||"POST",t.withCredentials=t.withCredentials||this.options.withCredentials,this.$http(t).then(function(t){e.storage.removeItem(e.tokenName)})):(this.storage.removeItem(this.tokenName),h.resolve())):h.reject(new Error("There is no currently authenticated user"))},O.prototype.authenticate=function(t,e,o){var n=this;return new h(function(o,r){var i=n.options.providers[t];if(!i)return r(new Error("Unknown provider"));var s;switch(i.oauthType){case"1.0":s=new j(n.$http,n.storage,i,n.options);break;case"2.0":s=new T(n.$http,n.storage,i,n.options);break;default:return r(new Error("Invalid OAuth type"))}return s.init(e).then(function(t){return n.setToken(t),n.isAuthenticated()?o(t):r(new Error("Authentication failed"))}).catch(function(){r(new Error("Authentication error occurred"))})})},w});